<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EventFilter Query Language &mdash; Query Language OPC UA EventFilter 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=af2ce170"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Query Language OPC UA EventFilter
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">EventFilter Query Language</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#extended-backus-naur-form">Extended Backus-Naur-Form</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Query Language OPC UA EventFilter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">EventFilter Query Language</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="eventfilter-query-language">
<h1>EventFilter Query Language<a class="headerlink" href="#eventfilter-query-language" title="Permalink to this heading"></a></h1>
<p>The following gives a short introduction into a newly proposed query langue to create OPC UA EventFilter.
The OPC Foundation specifies OPC UA EventFilter in the OPC UA Specification part 4:Services. EventFilter
consists of a selectClauses that defines a list of values to be returned from a filtered event and a whereClause
that defines a ContentFilter that contains criteria which have to be met to receive a notifications about the event. The values
listed in the selectCaluses are defined as SimpleAttributeOperands, so that the selectClauses consists of one or
multiple SimpleAttributeOperands. The ContentFilter is a collection of operators where each of them features
a corresponding set of operands.</p>
<p>In accordance to the EventFilter definition, the query language is split into a SELECT and a WHERE statement. Since the
whereClause can describe a complex structure of operators, the corresponding statement can be rather complex and confusing.
To increase the usability of the language, it introduces the FOR statement as an additional element that only occurs
within the language. Consequently, the concept of OPC UA EventFilter is not altered. The novelty of the FOR statement
are references for operators and operands. As a result, the WHERE statement can be simplified by referencing further
operands or operators as elements, which are then resolved within the FOR statement.</p>
<p>References can be used to link elements, either declared in the FOR statement or the in the  WHERE statement, to one
concrete element listed in the FOR statement. While multiple elements can reference one particular element,
each reference can only be resolved once. Since ElementOperands point to one ContentFilterElement inside the
ContentFilterElementArray, they can be seen as a reference from one operator to another. However, the logic of EventFilters only allows the OR and the AND operator to reference other operators.
References that are used to describe ElementOperands can be freely chosen, since they are replaced by the ContentFilterElementArrayIndex when constructing the EventFilter.</p>
<p>The example below should illustrate the logic of such references. Lines 1-4 specify the selectClauses of the filter. Each additional operand of the selectClauses is separated by a comma.
The ContentFilter is defined from line 5 on. The basic structure consitst of an OR operator (line 6), which references
a GREATHERTHAN operator with $”ref_1”. The corresponding operator is then resolved in line 8 and includes a reference to
an operand ($”ref_2”). The concrete operand is then declared in line 9 by dereferencing $”ref_2”:=. As last element, the OR
operator has an OFTYPE operator which references a NodeId that is defines in line 10 with reference $42.</p>
<p>1: SELECT</p>
<p>2: PATH “/Message”,</p>
<p>3: PATH “/0:Severity”,</p>
<p>4: PATH “/EventType”</p>
<p>5: WHERE</p>
<p>6: OR($”ref_1”, OFTYPE $42)</p>
<p>7: FOR</p>
<p>8: $”ref_1”:= PATH “/Severity” GREATERTHAN $”ref_2”</p>
<p>9: $”ref_2”:= UINT32 10</p>
<p>10: $42:= ns=1;i=5003</p>
<p>Since both, references and ElementOperands specify a reference to either an operand or an operator, they are have an equal notation.
Both are defined by setting a $ in front of either a number or a string in quotation marks.
However, they have to be resolved by extending the initial reference is extended with a :=, followed by either an operand or operator (see e.g. $”ref_1” declared in line 6 is the resolved in line 8). It
is important to consider that references to operands are only allowed for Operators and references to Operators are only
allowed by ElementOperands to create valid EventFilters. Additionally, references
can be nested, so that an initially referenced operators can contain further references to operands (The OR operator in line 6 references the GREATERTHAN operator in line 8, which in turn references the LiteralOperand in line 9).</p>
</section>
<section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h1>
<p>An implementation of this Query Language is accomplished with the open source open62541 OPC UA Stack. Examples on how to use it can be found here <a class="reference external" href="https://github.com/open62541/open62541/blob/master/examples/events">https://github.com/open62541/open62541/blob/master/examples/events</a></p>
<p>The open62541 stack provides two functions to generate EventFilters from queries. First, a single function to convert a ByteString, holding the Query, into an OPC UA EventFilter:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_EventFilter_parse</span><span class="p">(</span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">content</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">UA_EventFilter</span><span class="w"> </span><span class="o">*</span><span class="n">filter</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Second, a function that does not only create the EventFilter, but also subscribes the filter with a client:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_StatusCode</span><span class="w"></span>
<span class="w">    </span><span class="n">UA_Client_EventFilter_createSubscription</span><span class="p">(</span><span class="n">UA_Client</span><span class="w"> </span><span class="o">*</span><span class="n">client</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">UA_Client_EventNotificationCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">content</span><span class="p">,</span><span class="w"></span>
<span class="w">                                             </span><span class="n">UA_EventFilter</span><span class="w"> </span><span class="o">*</span><span class="n">filter</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Here, the UA_Client_EventNotificationCallback is a callback function that executes user-desired behavior, whenever a filtered event occurs.</p>
</section>
<section id="extended-backus-naur-form">
<h1>Extended Backus-Naur-Form<a class="headerlink" href="#extended-backus-naur-form" title="Permalink to this heading"></a></h1>
<p>The following figure illustrates the ebnf of the query language.</p>
<iframe src="_static/parser.html" height="500px" width="100%"></iframe></section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Florian Düwel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>